### ๐ฌ๐ง [English version of this documentation](./README.en.md)

# autodnscrypt

[![Go](https://img.shields.io/badge/Go-1.20%2B-007acc?style=for-the-badge)](https://go.dev)
[![Release](https://img.shields.io/github/release/mascotmascot1/autodnscrypt.svg?label=Release&color=007acc&style=for-the-badge)](https://github.com/mascotmascot1/autodnscrypt/releases/latest)
[![Platform](https://img.shields.io/badge/Platform-Windows-007acc?style=for-the-badge)](https://github.com/mascotmascot1/autodnscrypt)
[![License: MIT](https://img.shields.io/badge/License-MIT-007acc?style=for-the-badge)](https://github.com/mascotmascot1/autodnscrypt/blob/main/LICENSE)


> โ๏ธ **ะัะบะฐะท ะพั ะพัะฒะตัััะฒะตะฝะฝะพััะธ:*- ะญัะพั ะฟัะพะตะบั ะฝะต ัะฒัะทะฐะฝ ั ัะฐะทัะฐะฑะพััะธะบะฐะผะธ [`dnscrypt-proxy`](https://github.com/DNSCrypt/dnscrypt-proxy), ะฝะต ะฟะพะดะดะตัะถะธะฒะฐะตััั ะธ ะฝะต ะพะดะพะฑัะตะฝ ะธะผะธ.

> โ๏ธ **ะัะธะผะตัะฐะฝะธะต:*- ะฃัะธะปะธัะฐ ัะฐะทัะฐะฑะพัะฐะฝะฐ ัะฟะตัะธะฐะปัะฝะพ ะดะปั ัะธััะตะผ **Windows**. ะะฝะฐ ะธัะฟะพะปัะทัะตั PowerShell ะดะปั ะธะทะผะตะฝะตะฝะธั ะฝะฐัััะพะตะบ DNS ะธ ะฟัะตะดะฟะพะปะฐะณะฐะตั ะฝะฐะปะธัะธะต ัััะฐะฝะพะฒะปะตะฝะฝะพะณะพ `dnscrypt-proxy` ะดะปั Windows.

## ๐งญ ะะฐะทะฝะฐัะตะฝะธะต

`autodnscrypt` ัะพะทะดะฐะฝ ะดะปั ัะฟัะพัะตะฝะธั ะธัะฟะพะปัะทะพะฒะฐะฝะธั `dnscrypt-proxy` ะฒ Windows, ะพัะพะฑะตะฝะฝะพ ะฒ ััะตะฝะฐัะธัั ั VPN ะธะปะธ ะฒะธัััะฐะปัะฝัะผะธ ัะตัะตะฒัะผะธ ะธะฝัะตััะตะนัะฐะผะธ, ะบะพัะพััะต ะฟะพะปััะฐัั ะฝะพะฒัะน IP-ะฐะดัะตั ะฟัะธ ะบะฐะถะดะพะผ ะฟะพะดะบะปััะตะฝะธะธ.

ะ ัะฐะบะธั ัะปััะฐัั ะฟัะธะฒัะทะบะฐ `dnscrypt-proxy` ะบ `127.0.0.1` ะธะปะธ `:53` ัะฐััะพ ะฟัะธะฒะพะดะธั ะบ ัะฑะพัะผ ะฒ ัะฐะฑะพัะต DNS, ัะฐะบ ะบะฐะบ ะฒะธัััะฐะปัะฝัะต ะฐะดะฐะฟัะตัั (ะฝะฐะฟัะธะผะตั, ะธัะฟะพะปัะทัะตะผัะต OpenVPN) ะฝะต ะผะพะณัั ะพะฑัะฐัะฐัััั ะบ `localhost`. ะญัะฐ ััะธะปะธัะฐ ัะตัะฐะตั ะฟัะพะฑะปะตะผั ัะปะตะดัััะธะผ ะพะฑัะฐะทะพะผ:

- ะะฒัะพะผะฐัะธัะตัะบะธ ะพะฟัะตะดะตะปัะตั ัะตะบััะธะน IPv4-ะฐะดัะตั ัะบะฐะทะฐะฝะฝะพะณะพ ะธะฝัะตััะตะนัะฐ.
- ะะฑะฝะพะฒะปัะตั ัะฐะนะป ะบะพะฝัะธะณััะฐัะธะธ `dnscrypt-proxy.toml`, ะฟัะธะฒัะทัะฒะฐั `dnscrypt-proxy` ะธะผะตะฝะฝะพ ะบ ััะพะผั IP.
- ะัะฟะพะปัะทัะตั PowerShell ะดะปั ัััะฐะฝะพะฒะบะธ ััะพะณะพ IP ะฒ ะบะฐัะตััะฒะต DNS-ัะตัะฒะตัะฐ ะดะปั ะดะฐะฝะฝะพะณะพ ะธะฝัะตััะตะนัะฐ.
- ะะฐะฟััะบะฐะตั `dnscrypt-proxy.exe`.

ะฅะพัั ะธะฝััััะผะตะฝั ะพะฟัะธะผะธะทะธัะพะฒะฐะฝ ะดะปั ะดะธะฝะฐะผะธัะตัะบะธั ะธะฝัะตััะตะนัะพะฒ, ะพะฝ ะฟะพะดะดะตัะถะธะฒะฐะตั ะธ ััะฐัะธัะตัะบะธะต โ ะฟัะพััะพ ัะบะฐะถะธัะต ะฟัะฐะฒะธะปัะฝะพะต ะธะผั ะธะฝัะตััะตะนัะฐ (`interfaceName`) ะฒ ัะฐะนะปะต `config.yaml`.

ะญัะพ ะธัะบะปััะฐะตั ะฝะตะพะฑัะพะดะธะผะพััั ัััะฝะพะน ะฝะฐัััะพะนะบะธ ะธ ะพะฑะตัะฟะตัะธะฒะฐะตั ััะฐะฑะธะปัะฝัั ัะฐะฑะพัั dnscrypt, ั.ะต. ะฟะตัะตะฝะฐะฟัะฐะฒะปะตะฝะธะต ะธ ัะธััะพะฒะฐะฝะธะต (ะบ ะฟัะธะผะตัั DoH - DNS over HTTPS) DNS-ััะฐัะธะบะฐ  ัะตัะตะท ะฟัะฐะฒะธะปัะฝัะน ัะตัะตะฒะพะน ะธะฝัะตััะตะนั.

> โ๏ธ **ะัะธะผะตัะฐะฝะธะต:*- ะญัะพั ะธะฝััััะผะตะฝั ะฝะต ะฝะฐัััะฐะธะฒะฐะตั ัะฐะผ `dnscrypt-proxy` โ ัะฐะบะธะต ััะฝะบัะธะธ, ะบะฐะบ DoH ะธะปะธ TCP-only, ะดะพะปะถะฝั ะฑััั ะฒะบะปััะตะฝั ะฒัััะฝัั ะฒ `dnscrypt-proxy.toml`. `autodnscrypt` ัะพะบััะธััะตััั ะธัะบะปััะธัะตะปัะฝะพ ะฝะฐ ะฟัะธะฒัะทะบะต ะบ ะฟัะฐะฒะธะปัะฝะพะผั ะธะฝัะตััะตะนัั ะธ ัััะฐะฝะพะฒะบะต ะผะฐัััััะธะทะฐัะธะธ DNS.

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ


```

project/
โโโ cmd/
โย ยโโโ autodnscrypt/
โย ย ย ยโโโ main.go # ัะพัะบะฐ ะฒัะพะดะฐ
โโโ internal/
โย ยโโโ dnscrypt/
โย ย ย ยโโโ config.go # ะทะฐะณััะทะบะฐ config.yamlยย
โย ย ย ยโโโ ip.go # ะฟะพะปััะตะฝะธะต IPv4 ะฐะดัะตัะฐ ะธะฝัะตััะตะนัะฐย ย ย ย ยย
โย ย ย ยโโโ update.go # ะพะฑะฝะพะฒะปะตะฝะธะต dnscrypt-proxy.tomlย ย ย ย
โย ย ย ยโโโ launch.go # ะทะฐะฟััะบ ะธัะฟะพะปะฝัะตะผะพะณะพ ัะฐะนะปะฐ ะธ ะฝะฐัััะพะนะบะฐ DNSย
โโโ screenshots/
โย ย ย ยโโโ dnscryptlaunch.png
โย ย ย ยโโโ ipleakdns.png
โโโ scripts/
โย ย ย ยโโโ killdnscrypt.bat
โโโ config.yaml
โโโ go.mod
โโโ .gitignore
โโโ README.md

```

## โ๏ธ ะะพะฝัะธะณััะฐัะธั

ะะฐัััะพะนะบะธ ะทะฐะดะฐัััั ัะตัะตะท ัะฐะนะป `config.yaml`, ะบะพัะพััะน ะดะพะปะถะตะฝ ะฝะฐัะพะดะธัััั ะฒ **ัะพะน ะถะต ะดะธัะตะบัะพัะธะธ, ััะพ ะธ ัะบะพะผะฟะธะปะธัะพะฒะฐะฝะฝัะน ะฑะธะฝะฐัะฝัะน ัะฐะนะป**.

### ะัะธะผะตั `config.yaml`:

```yaml
dnscryptConfigPath: "C:/Program Files/DNSCrypt/dnscrypt-proxy.toml"
dnscryptExePath: "C:/Program Files/DNSCrypt/dnscrypt-proxy.exe"
interfaceName: "OpenVPN Data Channel Offload"

# ะัะธะผะตัะฐะฝะธะต: ะัะปะธ ะฒั ะธัะฟะพะปัะทัะตัะต ะพะฑัะฐัะฝัะต ัะปะตัะธ (\) ะฒ ะฟัััั Windows, ะธั ะฝัะถะฝะพ ัะบัะฐะฝะธัะพะฒะฐัั.
# ะัะธะผะตั:
# dnscryptExePath: "C:\\Program Files\\DNSCrypt\\dnscrypt-proxy.exe"
```

## ๐ ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั

### `autodnscrypt`:

- ะะฟัะตะดะตะปัะตั IPv4-ะฐะดัะตั ะธะฝัะตััะตะนัะฐ, ัะบะฐะทะฐะฝะฝะพะณะพ ะฒ `config.yaml`.
- ะะฐะผะตะฝัะตั ัััะพะบั ะฒ `dnscrypt-proxy.toml`:
```
listen_addresses = [':53']
```

ะฝะฐ:
```
listen_addresses = ['<ะะะจ_IP>:53']
```

- ะะฑะฝะพะฒะปัะตั ะฝะฐัััะพะนะบะธ DNS ะดะปั ะธะฝัะตััะตะนัะฐ ั ะฟะพะผะพััั PowerShell:
  ```powershell
  Set-DnsClientServerAddress -InterfaceAlias "<InterfaceName>" -ServerAddresses <IP>
  ```

- ะะฐัะตะผ ะทะฐะฟััะบะฐะตั `dnscrypt-proxy.exe`.

โน๏ธ **ะัะพัะตัั ะฒัะฟะพะปะฝะตะฝะธั**

ะะพัะปะต ัะพะณะพ ะบะฐะบ `autodnscrypt` ะทะฐะฒะตััะธั ะพะฑะฝะพะฒะปะตะฝะธะต ะบะพะฝัะธะณะฐ ะธ ะฝะฐัััะพะนะบั DNS, ะพะฝ ะทะฐะฟััะบะฐะตั `dnscrypt-proxy.exe` ะฒ ัะพะฝะพะฒะพะผ ัะตะถะธะผะต ะธ ะทะฐะฒะตััะฐะตั ัะฒะพั ัะฐะฑะพัั.

ะญัะพ ะฝะพัะผะฐะปัะฝะพะต ะฟะพะฒะตะดะตะฝะธะต: ััะธะปะธัะฐ ัะฐะฑะพัะฐะตั ะบะฐะบ ะธะฝะธัะธะฐะปะธะทะฐัะพั. ะัะพัะตัั `dnscrypt-proxy` ะฟัะพะดะพะปะถะฐะตั ัะฐะฑะพัะฐัั ะฝะตะทะฐะฒะธัะธะผะพ. ะั ะฝะต ัะฒะธะดะธัะต `autodnscrypt.exe` ะฒ ะดะธัะฟะตััะตัะต ะทะฐะดะฐั ะฟะพัะปะต ะทะฐะฟััะบะฐ โ ัะฐะบ ะธ ะดะพะปะถะฝะพ ะฑััั.

ะะตัั ะฒัะฒะพะด (ัะพะพะฑัะตะฝะธั ะพะฑ ััะฟะตัะต ะธะปะธ ะพัะธะฑะบะฐั) ัะพััะฐะฝัะตััั ะฒ ัะฐะนะป `log.txt` ะฒ **ัะพะน ะถะต ะดะธัะตะบัะพัะธะธ, ะณะดะต ะฝะฐัะพะดะธััั ะธัะฟะพะปะฝัะตะผัะน ัะฐะนะป**.ยย
ะัะพะฒะตัััะต ััะพั ัะฐะนะป, ะตัะปะธ ััะพ-ัะพ ัะฐะฑะพัะฐะตั ะฝะต ัะฐะบ, ะบะฐะบ ะพะถะธะดะฐะปะพัั.

## ๐งช ะัะพะฒะตัะบะฐ

ะงัะพะฑั ะฟัะพัะผะพััะตัั ัะตะบััะธะต ะฝะฐัััะพะนะบะธ DNS ะธ ัะฑะตะดะธัััั, ััะพ ะธะทะผะตะฝะตะฝะธั ะฟัะธะผะตะฝะธะปะธัั ะบะพััะตะบัะฝะพ, ะฒัะฟะพะปะฝะธัะต ัะปะตะดััััั ะบะพะผะฐะฝะดั ะฒ PowerShell:

```powershell
Get-DnsClientServerAddress

```
![PS Verifying](screenshots/psverifying.png)

ะญัะฐ ะบะพะผะฐะฝะดะฐ ะฒัะฒะตะดะตั ัะฟะธัะพะบ DNS-ัะตัะฒะตัะพะฒ ะดะปั ะฒัะตั ะธะฝัะตััะตะนัะพะฒ, ััะพ ะฟะพะผะพะถะตั ะฟะพะดัะฒะตัะดะธัั ะฟัะฐะฒะธะปัะฝะพััั ะฝะฐัััะพะนะบะธ ัะตะปะตะฒะพะณะพ ะฐะดะฐะฟัะตัะฐ.

### ๐ฆ ะะพะดัะฒะตัะถะดะตะฝะธะต ะทะฐะฟััะบะฐ ะฟัะพะบัะธ

ะะฐ ัะบัะธะฝัะพัะต ะฝะธะถะต ะฟะพะบะฐะทะฐะฝ ััะฟะตัะฝัะน ะทะฐะฟััะบ `dnscrypt-proxy.exe` ะฒ ะฐะฒัะพะฝะพะผะฝะพะผ ัะตะถะธะผะต (ะฝะต ะบะฐะบ ัะปัะถะฑะฐ Windows). ะะฝะธัะธะฐะปะธะทะธัะพะฒะฐะฝะพ ะฝะตัะบะพะปัะบะพ ัะตะทะพะปะฒะตัะพะฒ, ะปะพะบะฐะปัะฝัะน ะฟัะพะบัะธ DNS-ัะตัะฒะตั ะฐะบัะธะฒะตะฝ:

![Proxy Startup](screenshots/dnscryptlaunch.png)

> โ๏ธ **ะัะธะผะตัะฐะฝะธะต**: ะญัะพั ัะบัะธะฝัะพั ัะดะตะปะฐะฝ ะฒ ะฒะตััะธะธ **v1.0.0*- ะฟัะพะณัะฐะผะผั `autodnscrypt.exe`.ยย
> ะ ัะพะน ะฒะตััะธะธ ััะธะปะธัะฐ ะฒัะฒะพะดะธะปะฐ ัะพะพะฑัะตะฝะธั ะพ ััะฐัััะต (ะฝะฐะฟัะธะผะตั, `Configuration file successfully updated`) ะฟััะผะพ ะฒ ะบะพะฝัะพะปั.ยย
> ะะฐัะธะฝะฐั ั ะฒะตััะธะธ **v1.1.0**, ะฒัะต ะฟะพะดะพะฑะฝัะต ัะพะพะฑัะตะฝะธั ะฟะธััััั ะธัะบะปััะธัะตะปัะฝะพ ะฒ `log.txt`, ะฐ ะฒ ะพะบะฝะต ัะตัะผะธะฝะฐะปะฐ ะฒะธะดะตะฝ ัะพะปัะบะพ ะฒัะฒะพะด ัะฐะผะพะณะพ `dnscrypt-proxy.exe`.

### ๐ ะขะตัั ะฝะฐ ััะตัะบั DNS โ ipleak.net

ะญัะพ ะฟะพะดัะฒะตัะถะดะฐะตั, ััะพ DNS-ะทะฐะฟัะพัั ัะฐะทัะตัะฐัััั ัะตัะตะท ะฝะฐัััะพะตะฝะฝัะต ะฑะตะทะพะฟะฐัะฝัะต ัะตะทะพะปะฒะตัั (ะฝะฐะฟัะธะผะตั, ะคัะฐะฝัะธั, ะคะธะฝะปัะฝะดะธั, ะะตัะผะฐะฝะธั), ะฐ ะฝะต ัะตัะตะท ัะธััะตะผะฝัะน DNS ะธะปะธ ะฟัะพะฒะฐะนะดะตัะฐ:

![ipleak.net DNS Results](screenshots/ipleakdns.png)

## ๐๏ธ ะกะฑะพัะบะฐ

ะะท ะบะพัะฝะตะฒะพะน ะดะธัะตะบัะพัะธะธ ะฟัะพะตะบัะฐ ะฒั ะผะพะถะตัะต ัะพะฑัะฐัั ะธัะฟะพะปะฝัะตะผัะน ัะฐะนะป ะดะฒัะผั ัะฟะพัะพะฑะฐะผะธ:

### 1. ๐งฑ ะกัะฐะฝะดะฐััะฝะฐั ัะฑะพัะบะฐ (ะบะพะฝัะพะปัะฝัะน ัะตะถะธะผ)

```bash
go build -o autodnscrypt.exe ./cmd/autodnscrypt

```

ะญัะฐ ะฒะตััะธั ัะฐะฑะพัะฐะตั ะบะฐะบ ะพะฑััะฝะพะต ะบะพะฝัะพะปัะฝะพะต ะฟัะธะปะพะถะตะฝะธะต โ ะฟัะธ ะทะฐะฟััะบะต ะฝะฐ ะบะพัะพัะบะพะต ะฒัะตะผั ะฟะพัะฒะธััั ะพะบะฝะพ ัะตัะผะธะฝะฐะปะฐ.

### 2. ๐ช ะกะบัััะฐั ัะฑะพัะบะฐ (ะฑะตะท ะพะบะฝะฐ ะบะพะฝัะพะปะธ)

```bash
go build -ldflags="-H windowsgui" -o autodnscrypt.exe ./cmd/autodnscrypt

```

ะะพะผะฐะฝะดะฐ ัะพะฑะธัะฐะตั `autodnscrypt.exe` ะบะฐะบ ะฟัะธะปะพะถะตะฝะธะต ัะธะฟะฐ `windowsgui` โ ะพะฝะพ ะทะฐะฟััะบะฐะตััั ัะธัะพ ะฒ ัะพะฝะพะฒะพะผ ัะตะถะธะผะต, **ะฝะต ะพัะบััะฒะฐั ะพะบะฝะฐ ัะตัะผะธะฝะฐะปะฐ**.

> โ๏ธ **ะัะธะผะตัะฐะฝะธะต:*- ะฃะฑะตะดะธัะตัั, ััะพ ัะบะพะผะฟะธะปะธัะพะฒะฐะฝะฝัะน `.exe` ัะฐะนะป ะฝะฐัะพะดะธััั ะฒ ัะพะน ะถะต ะฟะฐะฟะบะต, ััะพ ะธ `config.yaml`.

### ๐ก๏ธ ะััะฐะฝะพะฒะบะฐ ัะบัััะพะณะพ ะฟัะพัะตััะฐ

ะัะปะธ ะฒั ัะพะฑัะฐะปะธ `autodnscrypt.exe` ะธะปะธ ะทะฐะฟัััะธะปะธ `dnscrypt-proxy.exe` ั ัะปะฐะณะพะผ `-ldflags="-H windowsgui"` (ัะธัะธะน ัะตะถะธะผ), ะฟัะพัะตัั ะฑัะดะตั ัะฐะฑะพัะฐัั **ะฑะตะท ะฒะธะดะธะผะพะณะพ ะพะบะฝะฐ ะบะพะฝัะพะปะธ**.ยย
ะงัะพะฑั ะพััะฐะฝะพะฒะธัั ะตะณะพ ะฒัััะฝัั, ะฒั ะผะพะถะตัะต ะธัะฟะพะปัะทะพะฒะฐัั ะฒะบะปััะตะฝะฝัะน ะฒ ะฟัะพะตะบั ัะบัะธะฟั `killdnscrypt.bat`.

> โ๏ธ **ะัะธะผะตัะฐะฝะธะต:*- ะกะบัะธะฟั ะธัะตั ะฟัะพัะตัั ั ะธะผะตะฝะตะผ `dnscrypt-proxy.exe`.ยย
> ะัะปะธ ะฒะฐั ะธัะฟะพะปะฝัะตะผัะน ัะฐะนะป ะฝะฐะทัะฒะฐะตััั ะธะฝะฐัะต, ะพัะบัะพะนัะต `.bat` ัะฐะนะป ะฒ ะะปะพะบะฝะพัะต ะธ ะพััะตะดะฐะบัะธััะนัะต ะตะณะพ ะฒัััะฝัั.

## โ ะขัะตะฑะพะฒะฐะฝะธั

- Go 1.20 ะธะปะธ ะฝะพะฒะตะตยย
- ะฃััะฐะฝะพะฒะปะตะฝะฝัะน `dnscrypt-proxy` (ะฟัะพัะตััะธัะพะฒะฐะฝะพ ะฝะฐ ะฒะตััะธัั 2.1.8 ะธ 2.1.12)ยย
- Windows ั ะดะพัััะฟะฝัะผ PowerShellยย
- ะัะฐะฒะฐ ะฐะดะผะธะฝะธัััะฐัะพัะฐ ะดะปั ะฝะฐัััะพะนะบะธ ะบะพะฝัะธะณััะฐัะธะธ DNS

## โ๏ธ ะะฐะถะฝัะต ะทะฐะผะตัะบะธ

- ะะฐะฟััะบะฐะนัะต ะธัะฟะพะปะฝัะตะผัะน ัะฐะนะป ั ะฟัะฐะฒะฐะผะธ ะฐะดะผะธะฝะธัััะฐัะพัะฐ, ััะพะฑั PowerShell ะผะพะณ ะฟัะธะผะตะฝะธัั ะธะทะผะตะฝะตะฝะธั DNS.
- ะฃะฑะตะดะธัะตัั, ััะพ `interfaceName` ะฒ ัะพัะฝะพััะธ ัะพะฒะฟะฐะดะฐะตั ั ะธะผะตะฝะตะผ ะธะฝัะตััะตะนัะฐ, ะพัะพะฑัะฐะถะฐะตะผัะผ ะฒ ะบะพะผะฐะฝะดะต `ipconfig /all`.
